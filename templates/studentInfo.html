
<!DOCTYPE html>
<html lang="en">

<head>
  <title>DigiSchool</title>
  <meta charset="utf-8" />
  <link rel="apple-touch-icon" sizes="76x76" href="static/img/apple-icon.png">
  <link rel="icon" type="image/png" href="static/img/favicon.png">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no' name='viewport' />
  <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:400,700|Material+Icons" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css">
  <link rel="stylesheet" href="static/css/material-kit.css"  />
  <link rel="stylesheet" href="static/css/demo.css"/>
  <link rel="stylesheet" href="https://jqueryvalidation.org/files/demo/site-demos.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.12/css/bootstrap-select.min.css" />
  	
  <style>
    .box{
        padding: 5%;
    }
  </style>

  
</head>

<body>
  <nav class="navbar  fixed-top navbar-expand-lg" color-on-scroll="100" id="sectionsNav">
    <div class="container">
      <div class="navbar-translate">
        <a class="navbar-brand" href="https://demos.creative-tim.com/material-kit/index.html">
          DigiSchool </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" aria-expanded="false" aria-label="Toggle navigation">
          <span class="sr-only">Toggle navigation</span>
          <span class="navbar-toggler-icon"></span>
          <span class="navbar-toggler-icon">  </span>
          <span class="navbar-toggler-icon"></span>
        </button>
      </div>
      <div class="collapse navbar-collapse">
        <ul class="navbar-nav ml-auto">
          <li class="nav-item">
            <!-- <div w3-include-html="static/search.html"></div> -->
            
      </li>
      <li class="nav-item">
        <a href="#pablo" class="nav-link">
          About
        </a>
      </li>
      <li class="dropdown nav-item">
        <a href="/profile" class="profile-photo dropdown-toggle nav-link" data-toggle="dropdown">
          <div class="profile-photo-small">
            <img src="static/img/faces/avatar.jpg" alt="Circle Image" class="rounded-circle img-fluid">
          </div>
        </a>
        <div class="dropdown-menu dropdown-menu-right">
          <h6 class="dropdown-header">{{ name }}</h6>
          <a href="/signOut" class="dropdown-item">Sign out</a>
        </div>
      </li>
          
        </ul>
      </div>
    </div>
  </nav>
  <br><br><br>
    <div class = "box">
    <div class="card" >
        <div class="card-header card-header-text card-header-primary">
          <div class="card-text">
            <h4 class="card-title">Additional information to be filled by Parent/Guardian</h4>
          </div>
        </div>
        <div class="card-body">
          <br><br>
            <form class="form" id="studentForm" method='POST' >
              <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                <div class="input-group">
                    <div class="input-group-prepend">
                      <span class="input-group-text">
                        <i class="material-icons">perm_identity</i>
                      </span>
                    </div>
                    <input type="text" class="form-control validate" id="username"  name="username" value="{{user}}" disabled >
                  </div>
    
                  <div class="input-group">
                    <div class="input-group-prepend">
                      <span class="input-group-text">
                        <i class="material-icons">verified_user</i>
                      </span>
                    </div>
                    <input type="text" class="form-control validate" id="parentUsername"  name="parentUsername" placeholder="Parent Username" required>
                  </div>
                  <div class="input-group">
                    <div class="input-group-prepend">
                      <span class="input-group-text">
                        <i class="material-icons">lock_outline</i>
                    </span>
                    </div>
                    <input type="password" placeholder="Password" id="password" name="password" class="form-control" required>
                        
                  </div>
                  <div class="row">
                    <div class ="col">
                      <div class="input-group">
                        <div class="input-group-prepend">
                          <span class="input-group-text"> 
                            <i class="material-icons">school</i>
                          </span> 
                        </div>
                        <div class="col-sm-10" >
                        <select name="school" id="school" data-style="btn btn-outline-secondary" class="selectpicker form-control validate" data-live-search="true" title="Select school">
                          {% for i in range(schools[1]) %}
                          <option data-subtext="{{schools[0][i][1]}}" value="{{schools[0][i][0]}}" >
                           {{schools[0][i][2]}}
                          </option>
                          {% endfor %}
                        </select>
                      </div>
                      </div>
                    </div>
                    <div class ="col">
                      <div class="input-group" id="standardDiv">
                        <div class="input-group-prepend">
                          <span class="input-group-text"> 
                            <i class="material-icons">class</i>
                          </span> 
                        </div>
                        <div class="col-sm-10" >
                        <select name="standard" id="standard" data-style="btn btn-outline-secondary" class="selectpicker form-control validate" data-live-search="true" title="Standard">

                        </select>
                      </div>
                      </div>
                    </div>
                  </div>
                  <br><br>
                  <input class="btn btn-primary" type="submit" value="Submit" id="studentInfoSubmit">
                </form>
            </div>
        </div>
    </div>
    



      <script src="static/js/core/jquery.min.js" type="text/javascript"></script>
      <script src="static/js/core/popper.min.js" type="text/javascript"></script>
      <script src="static/js/core/bootstrap-material-design.min.js" type="text/javascript"></script>
      <script src="static/js/plugins/moment.min.js"></script>
      <script src="static/js/material-kit.js?v=2.0.6" type="text/javascript"></script>
      <script src="http://ajax.aspnetcdn.com/ajax/jquery.validate/1.11.1/jquery.validate.min.js"></script>
      <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
        <script src="static/js/plugins/nouislider.min.js" type="text/javascript"></script>
      <script src="static/js/notify.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.10.0/js/bootstrap-select.min.js"></script>
     
      <script>
    
        
          $('#studentInfoSubmit').click(function(event){
            event.preventDefault();
            var formData = new FormData(document.getElementById('studentForm'));
            if(formData.get('school') == ''){
              $("#school").notify("School field is empty");
            }
            else if(formData.get('standard') == ''){
              $("#standard").notify("Standard field is empty");
            }
            else{  
              dataStudent = {
                username: '{{user}}',
                parentUsername: formData.get('parentUsername'),
                password : formData.get('password'),
                school : formData.get('school'),
                standard : formData.get('standard')
              }
              console.log(dataStudent)
              $.ajax({
                url : '/student_info',
                type: 'POST',
                data:JSON.stringify(dataStudent),
                dataType: "json",
                contentType: 'application/json;charset=UTF-8',
                processData: false,
                sucess:function(data){
                  console.log("success")
                  if(data['msg'] == "Information Registered"){
                    location.reload()
                  }
                },
                error: function(data) {
                  $.notify("Error in registration", {align:"center", verticalAlign:"top"});
                },
            }).done(function(data) {
              $.notify(data['msg'],"info");
            });
            }

          });

          


          $(function() {
          $('.selectpicker').selectpicker();
          $('.select').selectpicker();
        });
            
     
    
        $(document).ready(function() {
          $("#standardDiv").hide();
        });



        $(document).ready(function(){
            $('#school').change(function(event){
              var inputValue = document.getElementById('school');
              console.log(inputValue.value);
              $.ajax({
              url: '/classStructure',
              type: 'POST',
              data: inputValue.value,
              dataType: 'json',
              processData: false,
              contentType: false,
              success: function ( dataClass ){
                data = dataClass['class_data']
                var i = 0;
                $("#standard option").remove();
                $('#standard').selectpicker('refresh');
                $('#school').selectpicker('refresh');
                for(i=0;i<data.length;i++){
                  var op = document.createElement('option');
                  op.text = data[i][1] + " "+ data[i][2];
                  op.value = data[i][0];
                  val = data[i][0];
                  dataC = data[i][1] + " "+ data[i][2];
                  $("#standard").append(op);  
                  }
                var standardDiv = document.getElementById('standardDiv');
                $("#standardDiv").show();
                $('#standard').selectpicker('refresh');
                
              },
              error: function(data) {
                $.notify("Internal Problem. Kindly refresh the page", {align:"center", verticalAlign:"top"});
              },
          }).done(function(dataClass) {
            
          });

        });
        });



    var csrf_token = "{{ csrf_token() }}";
    console.log(csrf_token)

    $.ajaxSetup({
        beforeSend: function(xhr, settings) {
            if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type) && !this.crossDomain) {
                xhr.setRequestHeader("X-CSRFToken", csrf_token);
            }
        }
    });

        $(document).ready(function() {
          var message = '{{msg}}'
          $.notify(message)
        });
    
    </script>
</body>

</html>