<!doctype html>
<html lang="en">
  <title>DigiSchool</title>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <link rel="apple-touch-icon" sizes="76x76" href="static/img/apple-icon.png">
  <link rel="icon" type="image/png" href="static/img/favicon.png">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no' name='viewport' />
  <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:400,700|Material+Icons" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://jqueryvalidation.org/files/demo/site-demos.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.12/css/bootstrap-select.min.css" />
  <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:400,700|Material+Icons" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css">
  <link href="static/css/material-dashboard.css?v=2.1.2" rel="stylesheet" />
  <!-- <link rel="stylesheet" type="text/css" href="static/css/jquery.scrolling-tabs.css" /> -->
  
  <style>
    .box{
        display: none;
    }
   
    .bootstrap-select .btn:focus {
    outline: none !important;
}
  </style>

  
</head>

<body>
  <div class="wrapper ">
    <div class="sidebar" data-color="purple" data-background-color="white">
      <div class="logo">
        <div class="row" >
          <div class="col-sm-2"></div>
          <div class="col-sm-8" >
            <form class="form" method="POST" id="photoForm" enctype="multipart/form-data">
            <label>
              <input type="file" name="file" id="photo" hidden/>
              <div class="profile-photo-small" >
                {% if profile==1 %}
                <img src="static/img/faces/profile.png" alt="Circle Image"  style="height:150px;" class="rounded-circle img-fluid">
                {% else %}
                <img src="static/img/faces/{{user}}.png" alt="Circle Image"  style="height:150px;" class="rounded-circle img-fluid">
                {% endif %}
              </div>
            </label>
          </form>
        </div>
    </div>
        <div style="text-align: center; padding: 10%;">
          <h3>{{ school_info[0][4] }}</h3>
        </div>
      </div>
      <div class="sidebar-wrapper">
        <ul class="nav">
          <li>
            <div>
              <span style="float:left;">
                <i class="material-icons">home</i>
              </span>
              <h4>
                {{school_info[0][2]}}
              </h4>
            </div>
          </li>
          <li>
            <div>
              <span style="float:left;">
                <i class="material-icons">phone</i>
              </span>
              <h4>
                {{school_info[0][1]}}
              </h4>
            </div>
            
          </li>
          <li>
            <div>
              <span style="float:left;">
                <i class="material-icons">email</i>
              </span>
              <h4>
                {{school_info[0][3]}}
              </h4>
            </div>
          </li>
        </ul>
      </div>
    </div>
    <div class="main-panel">
      <nav class="navbar navbar-transparent navbar-color-on-scroll fixed-top navbar-expand-lg" color-on-scroll="100" id="sectionsNav">
        <div class="container-fluid">
          <div class="navbar-translate">
            <button class="navbar-toggler" type="button" data-toggle="collapse" aria-expanded="false" aria-label="Toggle navigation">
              <span class="sr-only">Toggle navigation</span>
              <span class="navbar-toggler-icon"></span>
              <span class="navbar-toggler-icon"></span>
              <span class="navbar-toggler-icon"></span>
            </button>
          </div>
          <div class="collapse navbar-collapse">
            <div class="collapse navbar-collapse">
                <ul class="navbar-nav ml-auto">
              <li class="nav-item">
                <a href="/profile">
                  Go to profile
                </a>
              </li>
                

                </ul>
              </div>
            </div>
        </div>
      </nav>

      <div class="content">
        <div class="container-fluid">
          <div class="row">
            <div class="card">
              <div class="card-body">
              <div class="row">
                <div class="col">
                  <div class="card-text ">
                    <h3><b>Assign teachers:</b></h3>
                  </div>
                </div>
                <div class="col">
                  <select name="class" id="class" data-style="btn btn-outline-secondary" class="selectpicker form-control validate" data-live-search="true" title="Select class">
                    {% for i in range(structure[1]) %}
                    <option value="{{structure[0][i][0]}}" >
                    {{structure[0][i][1]}}
                    </option>
                    {% endfor %}
                  </select>
                </div>
                
              </div>
              
          </div>
        </div>
      </div>
      <div class="row" id="after">
        <div class="card">
          <div class="card-body">
          <table class="table">
            <thead>
              <th>
                Subject
              </th>
              <th>
                Assigned teacher
              </th>
              <th>
                Teachers
              </th>
            </thead>
            <tbody id="struct">
              
            </tbody>
          </table>
          <div class="row">
            <div class="col">
            <button id="assignTeacher" class="btn btn-success">Set</button>
          </div>   
          </div>
      </div>
      </div>
    </div>
      </div>
      </div>
    
      <footer class="footer footer-default">
    <div class="container">
      <div class="float-left">
        
      </div>
      <div class="copyright float-right">
        &copy;
        <script>
          document.write(new Date().getFullYear())
        </script>, made with <i class="material-icons">favorite</i> by
        <a href="https://github.com/shubhanginigam18/" target="blank">Shuhangi</a> &
        <a href="https://github.com/anaghrao-99/" target="blank">Anagh</a>
        for a better web.
      </div>
    </div>
  </footer>
    </div>
  </div>
  <script src="static/js/core/jquery.min.js" type="text/javascript"></script>
  <script src="static/js/core/popper.min.js" type="text/javascript"></script>
  <script src="static/js/core/bootstrap-material-design.min.js" type="text/javascript"></script>
  <script src="static/js/plugins/moment.min.js"></script>
  <script src="static/js/material-kit.js?v=2.0.6" type="text/javascript"></script>
  <script src="http://ajax.aspnetcdn.com/ajax/jquery.validate/1.11.1/jquery.validate.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
	<script src="static/js/plugins/nouislider.min.js" type="text/javascript"></script>
  <script src="static/js/notify.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.10.0/js/bootstrap-select.min.js"></script>
  <!-- <script src="static/js/jquery.scrolling-tabs.js"></script> -->
  <script>

$("#photo").change(function(){
      formName = "#photoForm" 
      var form = $(formName)[0];
      var formData = new FormData(form);
      $.ajax({
        url : '/uploadPhoto',
            type: 'POST',
            enctype: 'multipart/form-data',
            data: formData,
            processData: false,
            contentType: false,
            success:function(data){
              console.log("success")
              location.reload();
              
            },
            error: function(data) {
              
            },
        }).done(function(data) {
          console.log("done")
        });
    });

    
    $("#class").change(function(){
      event.preventDefault();
      classval = document.getElementById('class');
      console.log(classval.value)
      $.ajax({
        url: 'getStructure',
        type: 'POST',
        data: classval.value,
        dataType: 'json',
        processData: false,
        contentType: false,
        success: function ( data ){
          if(data['msg'] == 'done'){
            var teachers = data['teachers']
            var structure = data['struct']
            $("#struct tr").remove();
            var i=0;
            for(i=0;i<structure.length;i++){
              content = '<tr><th>'+ structure[i][0]+'</th>'
              content = content + '<td> Assigned: <b>' + structure[i][1] + '</b></td>'
              content = content + '<td>' +'<select id='+(structure[i][0]).toString()+' data-style="btn btn-outline-success" class="selectpicker form-control validate teacher" data-live-search="true" title="Select teacher">'
              var j=0
              for(j=0;j<teachers.length;j++){
                content = content +'<option value='+teachers[j][0]+'>'+
                  teachers[j][1]+
                  '</option>'
              }
              content = content + '</select></td></tr>'
              
              $("#struct").append(content)
              $('.teacher').selectpicker('refresh');
              $("#after").show();
            }
            
            $.notify(data.msg, "success");
          }
          else{
            $.notify("Some error occured please try again","danger");
          }
        },
        error: function(data) {
          $.notify("Error", {align:"center", verticalAlign:"top"});
        },
      }).done(function(data) {
      });

    });

    $("#assignTeacher").click(function(){
      event.preventDefault();
      classval = document.getElementById('class');
      teach = []
      $('.teacher').each( function (){
        console.log(this.id)
        teach.push([this.id,this.value])
      }).get();
      dataC={
        classcode : classval.value,
        teachers : teach
      }
      console.log(dataC)
      
      $.ajax({
        url: 'setStructure',
        type: 'POST',
        data: JSON.stringify(dataC),
        dataType: "json",
        contentType: 'application/json;charset=UTF-8',
        processData: false,
        success: function ( data ){
          if(data['msg'] == 'done'){
            $.notify(data.msg, "success");
          }
          else{
            $.notify("Some error occured please try again","danger");
          }
        },
        error: function(data) {
          $.notify("Error", {align:"center", verticalAlign:"top"});
        },
      }).done(function(data) {
      });
    });


    $(document).ready(function() {
          $("#after").hide();
        });

    $(function() {
      $('.selectpicker').selectpicker();
    });

    var csrf_token = "{{ csrf_token() }}";
    console.log(csrf_token)

    $.ajaxSetup({
        beforeSend: function(xhr, settings) {
            if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type) && !this.crossDomain) {
                xhr.setRequestHeader("X-CSRFToken", csrf_token);
            }
        }
    });
  </script>
</body>

</html>